- name: Copy Mongo Repo
  copy:
   src: mongo.repo
   dest: /etc/yum.repos.d/mongo.repo

- name: Install MongoDB
  package: 
    name: mongodb-org
    state:  present

- name: replace a IP in MongoDB
  replace:
    path: /etc/mongod.conf
    regexp: '127\.0\.0\.1'
    replace: '0.0.0.0' 

- name: Start MongoDB
  service:
    name: mongod
    daemon_reload: yes
    state: restarted
    enabled: yes

- name: Check Schema Exists
  shell: echo show dbs | mongo | grep {{item}}
  register: out
  ignore_errors: True

- name: Load Schema
  shell: mongo localhost {{item}}
  args:
    chdir: /tmp/robo-shop/mongo
  loop:
    - catalogue.js
    - users.js 
  when: Schema loaded succeeded


